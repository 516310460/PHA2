(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1127:function(t,e,r){"use strict";r.r(e);r(184),r(71),r(112),r(93),r(132),r(42),r(79),r(80),r(636);e.default={history:{},timer:{},pollingtimer:{},subs:[],init:function(){this.history={},this.timer={},this.subs=[]},formatBar:function(data,t,e,r,n){var o=this,sub=this.subs.find((function(t){return t.symbolInfo===e.name}));if(!sub||!sub.lastBar)return!1;var l=sub.lastBar,c=sub.resolution;c.includes("1D")?c=1440:c.includes("1W")&&(c=10080);var m=60*c,f=l.time/1e3;Array.isArray(data)||(data=[data]),data.sort((function(a,b){return a.t-b.t}));return data.map((function(e){var o={};return Math.floor(e.t/m)*m>f?(o={low:l.close,high:l.close,open:l.close,close:e.c,volume:e.v}).time=t.global_get_local_time(e.t).valueOf():(o=l,e.c<l.low?o.low=e.c:e.c>l.high&&(o.high=e.c),n||"1"!=c.toString()&&!r||(o.volume=e.v),o.close=e.c),o})).forEach((function(t){var r=t;if(r.time<l.time)return!0;setTimeout((function(){sub.listener(r)}),6),sub.lastBar=r,o.history[e.name].lastBar=r})),!0},gettimer:function(t){switch(t=t.toString()){case"1":return 2e3;case"5":case"15":case"30":case"60":case"240":case"D":case"1D":case"1W":case"1M":return 5e3}},getLastBarsOther:function(t,e,r,n,o,l,c){var m=this;t.$pubsub.subscribe(t.$pubsub.changeNewMoney,(function(sub,r){if(r&&r.symble==t.symbleParameString){var data={t:r.ts,c:r.price,v:r.amount};m.formatBar.call(m,data,t,e,!1,!0)}})),function r(){t.$store.dispatch(t.$socket.url.quotation_kline_get,{type:t.resolutionInterval,size:1,symble:t.symbleParameString}).then((function(n){var data=n.data;if(data){var o=m.timer[e.name+"_"+t.resolutionInterval],sub=m.subs.find((function(t){return t.symbolInfo===e.name}));if(!sub)return;for(var l in-1!=o&&(sub=m.formatBar.call(m,data,t,e,!0)),m.timer)clearTimeout(m.timer[l]),m.timer[l]=-1;sub&&-1!=o&&(m.timer[e.name+"_"+t.resolutionInterval]=setTimeout(r,15e3))}}))}()},getLastBars:function(t,e,r,n,o,l,c){var m=this;t.$socket.invoke({sub:t.sub,type:t.$socket.type.quotation_kline_get}),t.$socket.is()||function n(){t.$store.dispatch(t.$socket.url.quotation_kline_get,{type:t.resolutionInterval,size:1,symble:t.symbleParameString}).then((function(o){var data=o.data;if(data){var l=m.formatBar.call(m,data,t,e);for(var c in m.pollingtimer)clearTimeout(m.pollingtimer[c]),m.pollingtimer[c]=-1;l&&(m.pollingtimer[e.name]=setTimeout(n,m.gettimer(r)))}}))}(),t.$socket.receive(t.$socket.type.quotation_kline_get,(function(r){if(r&&r.topic==t.sub){var data=r.data;m.formatBar.call(m,data,t,e)||t.$socket.uninvoke(t.$socket.type.quotation_kline_get)}}))},getBars:function(t,e,r,n,o,l,c){var m=o;this.history[e.name]&&this.history[e.name].firstBar&&(m=this.history[e.name].firstBar.time/1e3);var f={etime:m,type:t.resolutionInterval,symble:t.symbleParameString},h=this;return t.$store.dispatch("quotation_kline_get",f).then((function(r){var data=r.data;if(data){data.sort((function(a,b){return a.t-b.t}));var n=t.bars=data.map((function(e){return{time:t.global_get_local_time(e.t).valueOf(),low:e.l,high:e.h,open:e.o,close:e.c,volume:e.v}}));return h.history[e.name]={lastBar:n[n.length-1],firstBar:n[0]},n}return[]}))}}}}]);